#!/bin/bash
set -e
export GIT_WORK_TREE=${1:-~}
export GIT_DIR=$GIT_WORK_TREE/.dotfiles.git

if [[ $1 = '-h' || -z $1 && -d $GIT_DIR ]]; then
    echo "curl -Lfs http://git.io/~dangra |bash"
    echo "wget -qO- http://git.io/~dangra |bash"
    exit
fi

set -x
git clone --bare https://github.com/dangra/dotfiles $GIT_DIR
git config --add remote.origin.pushurl git@github.com:dangra/dotfiles
echo '*' >>$GIT_DIR/info/exclude
git reset --hard
(cd $GIT_WORK_TREE; git dotmodule update --init)
