#!/bin/bash
#
# usage:
# 	tunnel-to-hadoop [region]
#
# where "region" is "eu" or "us" (default is "us")
#
declare -A regionport
regionport[eu]=6666
regionport[us]=6667
region=${1:-us}
port=${regionport[$region]:-6667}
url=${2:-http://hadoop.ec2.$region.mydeco.com:50030}

# Dynamic Forward port to localhost:$port
ssh -C -N -f -D $port indexer.ec2.$region.mydeco.com -o ExitOnForwardFailure=yes
# Start chrome preconfigured to use previously set socks5 proxy
google-chrome --user-data-dir=/home/dan/.config/mydeco/chrome-proxy-$port \
	--proxy-server="socks5://localhost:$port" \
	$url

